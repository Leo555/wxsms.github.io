{"meta":{"id":"d3-note-enter-update-and-exit","title":"D3 Note - Enter, Update and Exit","date":"2016-11-10T11:43:10.000Z","categories":["JavaScript"],"tags":["D3"]},"html":"<p>在 D3 的使用过程中，我们见得最多的应当是类似如下的代码：</p>\n<pre><code><span class=\"hljs-keyword\">let</span> div = d3.select(<span class=\"hljs-string\">'body'</span>)\n  .selectAll(<span class=\"hljs-string\">'p'</span>)\n  .data([<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">15</span>])\n  .enter()\n  .append(<span class=\"hljs-string\">'p'</span>)\n  .text(<span class=\"hljs-function\"><span class=\"hljs-params\">d</span> =&gt;</span> d);\n</code></pre><p>将得到：</p>\n<pre><code><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>6<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>9<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>12<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>15<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n</code></pre><p>光看代码完全不能理解 D3 到底做了些什么，其实这里关键是 <code>enter</code> 的使用。</p>\n<!--more-->\n<h2>\n            <a name=\"Overall\" role=\"anchor\">\n              <span>Overall</span>\n            </a>\n          </h2><p><code>enter</code> 其实是一个选择集（selection），与其对应的还有 <code>update</code> 与 <code>exit</code>，选择集中的元素由原始选择集与绑定的数据决定。</p>\n<p><img src=\"http://7xjbxm.com1.z0.glb.clouddn.com/4-4-81.png\" alt=\"\"></p>\n<h2>\n            <a name=\"selection-enter\" role=\"anchor\">\n              <span>selection.enter</span>\n            </a>\n          </h2><blockquote>\n<p>Returns the enter selection: placeholder nodes for each datum that had no corresponding DOM element in the selection. The enter selection is determined by selection.data, and is empty on a selection that is not joined to data.</p>\n<p>The enter selection is typically used to create “missing” elements corresponding to new data.</p>\n</blockquote>\n<p>简述就是，<code>enter</code> 会根据现有 selection 与绑定的数据量，自动“补齐”所缺失的元素。</p>\n<p>比如，例子中，如果 <code>.selectAll(&#39;p&#39;)</code> 返回的 selection 中包含 3 个元素，那么因为 data 的长度为 5，<code>enter</code> 就会补齐缺失的 2 个元素，并返回包含这三个补齐元素的 selection，接下来的操作，就是针对这个 selection 进行的。</p>\n<p>因此，在进行 <code>enter</code> 操作时，一般会事先把相关现有元素尽数清除，以免出现漏操作的情况。</p>\n<p>至于再对 <code>enter</code> 选择集进行 <code>append</code> 操作时为什么会追加到 body 节点上去，这里就涉及到另一个概念：<code>selection.update</code></p>\n<h2>\n            <a name=\"selection-update\" role=\"anchor\">\n              <span>selection.update</span>\n            </a>\n          </h2><p>理解了 <code>enter</code>，<code>update</code> 就很简单了，顾名思义，所指就是已有的，能够与绑定 data 一一对应上的元素的选择集。</p>\n<p>因此，实际上并没有 <code>selection.update</code> 这个方法，因为没有必要，当前选到的就是 <code>update</code> 集了。</p>\n<p>至于为什么例子中的 <code>enter</code> 集能够追加到 <code>body</code> 中去，根据 D3 文档：</p>\n<blockquote>\n<p>If the specified type is a string, appends a new element of this type (tag name) as the last child of each selected element, or the next following sibling in the update selection if this is an enter selection.</p>\n</blockquote>\n<p>当进行 <code>selection.append</code> 操作时，如果 selection 是一个 <code>enter</code> 集，那么 <code>append</code> 就会向相应 <code>update</code> 集的末尾追加。那么，自然，如果 <code>update</code> 集为空，就会往父元素内追加。</p>\n<h2>\n            <a name=\"selection-exit\" role=\"anchor\">\n              <span>selection.exit</span>\n            </a>\n          </h2><blockquote>\n<p>Returns the exit selection: existing DOM elements in the selection for which no new datum was found.</p>\n</blockquote>\n<p>对于已有 DOM 元素但没有 data 与之绑定的集合，使用 <code>selection.exit</code> 来获取。</p>\n<p>如果集合没有绑定 data，则返回空集合。如果多次调用 <code>exit</code>，之后的 <code>exit</code> 会返回空集合。</p>\n<p>通常，对于 <code>exit</code> 集的操作，都是 <code>remove</code>：</p>\n<pre><code>selection.<span class=\"hljs-keyword\">exit</span>().remove()\n</code></pre><p>&nbsp;</p>\n"}