{"meta":{"id":"angular-tutorial-more-templating","title":"Angular 教程：更多的模板","date":"2015-12-29T08:44:23.000Z","categories":["JavaScript"],"tags":["AngularJs"]},"html":"<p>在这一步中，你将实现当用户点击手机列表中的一条记录时显示的详细视图。</p>\n<ul>\n<li>当你点击列表中的一条记录时，页面会显示一个带有该记录详细信息的视图</li>\n</ul>\n<p>为了实现这个目标，我们使用<a href=\"https://docs.angularjs.org/api/ng/service/$http\">$http</a>来抓取数据并刷新<code>phone-detail.html</code>视图模板。 最重要的改动如下所示。你可以在<a href=\"https://github.com/angular/angular-phonecat/compare/step-7...step-8\" title=\"See diff on Github\">GitHub</a>上查看它与之前的代码有何区别。</p>\n<hr>\n<h2>\n            <a name=\"数据\" role=\"anchor\">\n              <span>数据</span>\n            </a>\n          </h2><p>除了<code>phones.json</code>以外，<code>app/phones/</code>目录还包含了每台手机设备详细信息的JSON文件：</p>\n<p><code>app/phones/nexus-s.json</code>：</p>\n<pre><code>{\n  <span class=\"hljs-string\">\"additionalFeatures\"</span>: <span class=\"hljs-string\">\"Contour Display, Near Field Communications (NFC),...\"</span>,\n  <span class=\"hljs-string\">\"android\"</span>: {\n      <span class=\"hljs-string\">\"os\"</span>: <span class=\"hljs-string\">\"Android 2.3\"</span>,\n      <span class=\"hljs-string\">\"ui\"</span>: <span class=\"hljs-string\">\"Android\"</span>\n  },\n  ...\n  <span class=\"hljs-string\">\"images\"</span>: [\n      <span class=\"hljs-string\">\"img/phones/nexus-s.0.jpg\"</span>,\n      <span class=\"hljs-string\">\"img/phones/nexus-s.1.jpg\"</span>,\n      <span class=\"hljs-string\">\"img/phones/nexus-s.2.jpg\"</span>,\n      <span class=\"hljs-string\">\"img/phones/nexus-s.3.jpg\"</span>\n  ],\n  <span class=\"hljs-string\">\"storage\"</span>: {\n      <span class=\"hljs-string\">\"flash\"</span>: <span class=\"hljs-string\">\"16384MB\"</span>,\n      <span class=\"hljs-string\">\"ram\"</span>: <span class=\"hljs-string\">\"512MB\"</span>\n  }\n}\n</code></pre><p>这些文件使用了同样的格式来为手机设备描述一些各种各样的属性。我们会在详细视图中展现它们。</p>\n<hr>\n<h2>\n            <a name=\"控制器\" role=\"anchor\">\n              <span>控制器</span>\n            </a>\n          </h2><p>我们扩展了<code>PhoneDetailCtrl</code>控制器，在其中使用<code>$http</code>服务来抓取JSON文件，就跟获取手机列表的方式一模一样：</p>\n<p><code>app/js/controllers.js</code>：</p>\n<pre><code><span class=\"hljs-keyword\">var</span> phonecatControllers = angular.module(<span class=\"hljs-string\">'phonecatControllers'</span>,[]);\n\nphonecatControllers.controller(<span class=\"hljs-string\">'PhoneDetailCtrl'</span>, [<span class=\"hljs-string\">'$scope'</span>, <span class=\"hljs-string\">'$routeParams'</span>, <span class=\"hljs-string\">'$http'</span>,\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">($scope, $routeParams, $http)</span> </span>{\n    $http.get(<span class=\"hljs-string\">'phones/'</span> + $routeParams.phoneId + <span class=\"hljs-string\">'.json'</span>).success(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(data)</span> </span>{\n      $scope.phone = data;\n    });\n  }]);\n</code></pre><p>为了构建HTTP请求的URL，我们使用到了<code>$route</code>服务从当前路由中提取到的<code>$routeParams.phoneId</code></p>\n<hr>\n<h2>\n            <a name=\"模板\" role=\"anchor\">\n              <span>模板</span>\n            </a>\n          </h2><p>之前临时加入的TBD模板现在被一些包含手机详细信息的列表与绑定取代了。注意我们是如何使用Angular表达式以及<code>ngRepeat</code>来将手机数据从模型映射到视图上的。</p>\n<p><code>app/partials/phone-detail.html</code>：</p>\n<pre><code><span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">ng-src</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{phone.images[0]}}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"phone\"</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span></span><span class=\"hljs-template-variable\">{{phone.name}}</span><span class=\"xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span></span><span class=\"hljs-template-variable\">{{phone.description}}</span><span class=\"xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"phone-thumbs\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ng-repeat</span>=<span class=\"hljs-string\">\"img in phone.images\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">ng-src</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{img}}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"specs\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>Availability and Networks<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dl</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dt</span>&gt;</span>Availability<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dt</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dd</span> <span class=\"hljs-attr\">ng-repeat</span>=<span class=\"hljs-string\">\"availability in phone.availability\"</span>&gt;</span></span><span class=\"hljs-template-variable\">{{availability}}</span><span class=\"xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dd</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dl</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n    ...\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span>Additional Features<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dd</span>&gt;</span></span><span class=\"hljs-template-variable\">{{phone.additionalFeatures}}</span><span class=\"xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dd</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span>\n</code></pre><hr>\n<h2>\n            <a name=\"测试\" role=\"anchor\">\n              <span>测试</span>\n            </a>\n          </h2><p>我们为<code>PhoneListCtrl</code>编写了一个类似于step 5的单元测试。</p>\n<p><code>test/unit/controllersSpec.js</code>：</p>\n<pre><code>beforeEach(module(<span class=\"hljs-string\">'phonecatApp'</span>));\n\n  ...\n\n  describe(<span class=\"hljs-string\">'PhoneDetailCtrl'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span></span>{\n    <span class=\"hljs-keyword\">var</span> scope, $httpBackend, ctrl;\n\n    beforeEach(inject(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(_$httpBackend_, $rootScope, $routeParams, $controller)</span> </span>{\n      $httpBackend = _$httpBackend_;\n      $httpBackend.expectGET(<span class=\"hljs-string\">'phones/xyz.json'</span>).respond({name:<span class=\"hljs-string\">'phone xyz'</span>});\n\n      $routeParams.phoneId = <span class=\"hljs-string\">'xyz'</span>;\n      scope = $rootScope.$new();\n      ctrl = $controller(<span class=\"hljs-string\">'PhoneDetailCtrl'</span>, {$scope: scope});\n    }));\n\n\n    it(<span class=\"hljs-string\">'should fetch phone detail'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>{\n      expect(scope.phone).toBeUndefined();\n      $httpBackend.flush();\n\n      expect(scope.phone).toEqual({name:<span class=\"hljs-string\">'phone xyz'</span>});\n    });\n  });\n...\n</code></pre><p>你现在应该可以在Karma终端看到以下输出：</p>\n<pre><code>Chrome <span class=\"hljs-number\">22.0</span>: Executed <span class=\"hljs-number\">3</span> <span class=\"hljs-keyword\">of</span> <span class=\"hljs-number\">3</span> SUCCESS (<span class=\"hljs-number\">0.039</span> <span class=\"hljs-built_in\">secs</span> / <span class=\"hljs-number\">0.012</span> <span class=\"hljs-built_in\">secs</span>)\n</code></pre><p>同时我们也添加了一个端到端测试，验证当页面跳转到Nexus S详细视图的时候页头是不是真的显示了Nexus S</p>\n<p><code>test/e2e/scenarios.js</code>：</p>\n<pre><code>...\n  describe(<span class=\"hljs-string\">'Phone detail view'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>{\n\n    beforeEach(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>{\n      browser.get(<span class=\"hljs-string\">'app/index.html#/phones/nexus-s'</span>);\n    });\n\n\n    it(<span class=\"hljs-string\">'should display nexus-s page'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>{\n      expect(element(by.binding(<span class=\"hljs-string\">'phone.name'</span>)).getText()).toBe(<span class=\"hljs-string\">'Nexus S'</span>);\n    });\n  });\n...\n</code></pre><p>你可以通过执行<code>npm run protractor</code>来观察测试运行。</p>\n<h2>\n            <a name=\"课外扩展\" role=\"anchor\">\n              <span>课外扩展</span>\n            </a>\n          </h2><p>使用<a href=\"http://angular.github.io/protractor/#/api\">Protractor API</a>编写一个测试，验证我们在Nexus S详细页上显示了4张标题图片。</p>\n<h2>\n            <a name=\"总结\" role=\"anchor\">\n              <span>总结</span>\n            </a>\n          </h2><p>现在手机详细视图已经到位了，在<a href=\"/p/angular-tutorial-filters/\">step 9</a>中我们将学习如何编写自定义的过滤器。</p>\n"}