{"meta":{"id":"mean-js-menu-service-extension","title":"MEAN.js Menu Service Extension","date":"2016-01-05T17:34:47.000Z","categories":["JavaScript"],"tags":["AngularJs","MEAN-Stack"]},"html":"<p>MEAN.js解决方案只提供了1级/2级菜单栏的service支持，最近项目中需要用到第3级菜单，所以需要进行一个小的功能扩展。一开始我以为可以很容易地做到无限级，真正做起来以后发现并没有那么简单，所以目前通过这个办法只能达到第3级。</p>\n<!--more-->\n<h2 role=\"anchor\">\n            <a name=\"修改Menu服务\" role=\"anchor\">修改Menu服务</a>\n          </h2><p>初始的Menu Service中为使用者写了两个添加菜单项的方法：</p>\n<pre><code><span class=\"hljs-comment\">// Add menu item object</span>\n<span class=\"hljs-keyword\">this</span>.addMenuItem = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-params\">(menuId, options)</span></span>\n</code></pre><p>以及</p>\n<pre><code><span class=\"hljs-comment\">// Add submenu item object</span>\n<span class=\"hljs-keyword\">this</span>.addSubMenuItem = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-params\">(menuId, parentItemState, options)</span></span>\n</code></pre><p>第一个方法很显然就是用来添加顶级菜单了，第二个在没有看代码以前我曾经天真地以为它可以无限嵌套，然而并没有，它做的事情仅限于添加第2级菜单。所以现在我需要自己写第三个方法来完成添加第三级菜单。考虑到三级循环的效率问题，虽然一般来说菜单项不会有太多，但看起来就是非常不爽，所以我给每个Menu项都添加了一个哈希表来储存其下面所有菜单项的引用，这样多花费一点点内存就可以不用写循环嵌套了。由于使用了哈希表，对原2级菜单做了一些修改：</p>\n<pre><code><span class=\"hljs-comment\">// Add submenu item object</span>\n    <span class=\"hljs-keyword\">this</span>.addSubMenuItem = function (menuId, parentItemState, <span class=\"hljs-keyword\">options</span>) {\n        <span class=\"hljs-keyword\">options</span> = <span class=\"hljs-keyword\">options</span> || {};\n\n        <span class=\"hljs-comment\">// Validate that the menu exists</span>\n        <span class=\"hljs-keyword\">this</span>.validateMenuExistance(menuId);\n\n        <span class=\"hljs-comment\">// Search for menu item</span>\n        <span class=\"hljs-keyword\">for</span> (var itemIndex in <span class=\"hljs-keyword\">this</span>.menus[menuId].items) {\n            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">this</span>.menus[menuId].items[itemIndex].state === parentItemState) {\n                <span class=\"hljs-comment\">// Push new submenu item</span>\n                var newSubmenuItem = {\n                    title: <span class=\"hljs-keyword\">options</span>.title || <span class=\"hljs-string\">''</span>,\n                    state: <span class=\"hljs-keyword\">options</span>.state || <span class=\"hljs-string\">''</span>,\n                    disabled: <span class=\"hljs-keyword\">options</span>.disabled || <span class=\"hljs-keyword\">false</span>,\n                    roles: ((<span class=\"hljs-keyword\">options</span>.roles === <span class=\"hljs-keyword\">null</span> || typeof <span class=\"hljs-keyword\">options</span>.roles === <span class=\"hljs-string\">'undefined'</span>) ? <span class=\"hljs-keyword\">this</span>.menus[menuId].items[itemIndex].roles : <span class=\"hljs-keyword\">options</span>.roles),\n                    position: <span class=\"hljs-keyword\">options</span>.position || <span class=\"hljs-number\">0</span>,\n                    shouldRender: shouldRender,\n                    items: []\n                };\n                <span class=\"hljs-keyword\">this</span>.menus[menuId].items[itemIndex].items.<span class=\"hljs-keyword\">push</span>(newSubmenuItem);\n                <span class=\"hljs-keyword\">this</span>.menus[menuId].menuHash[newSubmenuItem.state] = newSubmenuItem;\n\n                <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">options</span>.items) {\n                    <span class=\"hljs-keyword\">for</span> (var i in <span class=\"hljs-keyword\">options</span>.items) {\n                        <span class=\"hljs-keyword\">this</span>.addSubMenuItemToSubMenu(menuId, <span class=\"hljs-keyword\">options</span>.state, <span class=\"hljs-keyword\">options</span>.items[i]);\n                    }\n                }\n            }\n        }\n\n        <span class=\"hljs-comment\">// Return the menu object</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">this</span>.menus[menuId];\n    };\n</code></pre><p>然后是新的添加3级菜单的方法：</p>\n<pre><code><span class=\"hljs-comment\">//For level 3 menu items</span>\n    <span class=\"hljs-built_in\">this</span>.addSubMenuItemToSubMenu = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> </span>(menuId, parentItemState, options) {\n        options = options || {};\n        <span class=\"hljs-built_in\">this</span>.validateMenuExistance(menuId);\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> itemIndex <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">this</span>.menus[menuId].menuHash) {\n            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.menus[menuId].menuHash[itemIndex].state === parentItemState) {\n                <span class=\"hljs-comment\">// Push new submenu item</span>\n                <span class=\"hljs-keyword\">var</span> <span class=\"hljs-keyword\">new</span><span class=\"hljs-type\">SubMenuItem</span> = {\n                    title: <span class=\"hljs-type\">options</span>.title || <span class=\"hljs-string\">''</span>,\n                    state: <span class=\"hljs-type\">options</span>.state || <span class=\"hljs-string\">''</span>,\n                    disabled: <span class=\"hljs-type\">options</span>.disabled || <span class=\"hljs-literal\">false</span>,\n                    roles: <span class=\"hljs-type\"></span>((options.roles === <span class=\"hljs-literal\">null</span> || typeof options.roles === <span class=\"hljs-string\">'undefined'</span>) ? <span class=\"hljs-built_in\">this</span>.menus[menuId].menuHash[itemIndex].roles : <span class=\"hljs-type\">options</span>.roles),\n                    position: <span class=\"hljs-type\">options</span>.position || <span class=\"hljs-number\">0</span>,\n                    shouldRender: <span class=\"hljs-type\">shouldRender</span>,\n                    items: <span class=\"hljs-type\"></span>[]\n                };\n                <span class=\"hljs-built_in\">this</span>.menus[menuId].menuHash[itemIndex].items.push(<span class=\"hljs-keyword\">new</span><span class=\"hljs-type\">SubMenuItem</span>);\n                <span class=\"hljs-built_in\">this</span>.menus[menuId].menuHash[<span class=\"hljs-keyword\">new</span><span class=\"hljs-type\">SubMenuItem</span>.state] = <span class=\"hljs-keyword\">new</span><span class=\"hljs-type\">SubMenuItem</span>;\n            }\n        }\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.menus[menuId];\n    };\n</code></pre><h2 role=\"anchor\">\n            <a name=\"修改Header模板\" role=\"anchor\">修改Header模板</a>\n          </h2><p>原Header模板中嵌套了两层Angular循环来遍历菜单项，我们给它加一层就好了，改完以后就像这样：</p>\n<pre><code><span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">nav</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"collapse navbar-collapse\"</span> <span class=\"hljs-attr\">uib-collapse</span>=<span class=\"hljs-string\">\"!isCollapsed\"</span> <span class=\"hljs-attr\">role</span>=<span class=\"hljs-string\">\"navigation\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"nav navbar-nav\"</span> <span class=\"hljs-attr\">ng-if</span>=<span class=\"hljs-string\">\"menu.shouldRender(authentication.user);\"</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ng-repeat</span>=<span class=\"hljs-string\">\"item in menu.items | orderBy: 'position'\"</span> <span class=\"hljs-attr\">ng-if</span>=<span class=\"hljs-string\">\"item.shouldRender(authentication.user);\"</span>\n          <span class=\"hljs-attr\">ng-switch</span>=<span class=\"hljs-string\">\"item.type\"</span>\n          <span class=\"hljs-attr\">ng-class</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{ active: $state.includes(item.state), dropdown: item.type === 'dropdown',disabled:item.disabled }</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">\"</span>\n          <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{item.class}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">}\"</span> <span class=\"hljs-attr\">uib-dropdown</span>=<span class=\"hljs-string\">\"item.type === 'dropdown'\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ng-switch-when</span>=<span class=\"hljs-string\">\"dropdown\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"dropdown-toggle\"</span> <span class=\"hljs-attr\">uib-dropdown-toggle</span> <span class=\"hljs-attr\">role</span>=<span class=\"hljs-string\">\"button\"</span>&gt;</span></span><span class=\"hljs-template-variable\">{{::item.title}</span><span class=\"xml\">}&amp;nbsp;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>\n          <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"caret\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">ng-switch-when</span>=<span class=\"hljs-string\">\"dropdown\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"dropdown-menu\"</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ng-repeat</span>=<span class=\"hljs-string\">\"subitem in item.items | orderBy: 'position'\"</span> <span class=\"hljs-attr\">ng-if</span>=<span class=\"hljs-string\">\"subitem.shouldRender(authentication.user);\"</span>\n              <span class=\"hljs-attr\">ui-sref-active</span>=<span class=\"hljs-string\">\"active\"</span> <span class=\"hljs-attr\">ng-class</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{'dropdown-submenu':subitem.items.length&gt;0,disabled:subitem.disabled}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{subitem.state}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">}\"</span> <span class=\"hljs-attr\">ng-bind</span>=<span class=\"hljs-string\">\"subitem.title\"</span> <span class=\"hljs-attr\">ng-if</span>=<span class=\"hljs-string\">\"subitem.items.length===0\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"javascript:;\"</span> <span class=\"hljs-attr\">ng-bind</span>=<span class=\"hljs-string\">\"subitem.title\"</span> <span class=\"hljs-attr\">ng-if</span>=<span class=\"hljs-string\">\"subitem.items.length&gt;0\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"dropdown-menu\"</span> <span class=\"hljs-attr\">ng-if</span>=<span class=\"hljs-string\">\"subitem.items.length&gt;0\"</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ng-repeat</span>=<span class=\"hljs-string\">\"i in subitem.items | orderBy: 'position'\"</span> <span class=\"hljs-attr\">ng-if</span>=<span class=\"hljs-string\">\"i.shouldRender(authentication.user);\"</span>\n                  <span class=\"hljs-attr\">ui-sref-active</span>=<span class=\"hljs-string\">\"active\"</span> <span class=\"hljs-attr\">ng-class</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{disabled:i.disabled}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{i.state}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">}\"</span> <span class=\"hljs-attr\">ng-bind</span>=<span class=\"hljs-string\">\"i.title\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ng-switch-default</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{item.state}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">}\"</span> <span class=\"hljs-attr\">ng-bind</span>=<span class=\"hljs-string\">\"item.title\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"nav navbar-nav navbar-right\"</span> <span class=\"hljs-attr\">ng-hide</span>=<span class=\"hljs-string\">\"authentication.user\"</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ui-sref-active</span>=<span class=\"hljs-string\">\"active\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"authentication.signup\"</span>&gt;</span>Sign Up<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"divider-vertical\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ui-sref-active</span>=<span class=\"hljs-string\">\"active\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"authentication.signin\"</span>&gt;</span>Sign In<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"nav navbar-nav navbar-right\"</span> <span class=\"hljs-attr\">ng-show</span>=<span class=\"hljs-string\">\"authentication.user\"</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"dropdown\"</span> <span class=\"hljs-attr\">uib-dropdown</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"dropdown-toggle user-header-dropdown-toggle\"</span> <span class=\"hljs-attr\">uib-dropdown-toggle</span> <span class=\"hljs-attr\">role</span>=<span class=\"hljs-string\">\"button\"</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">ng-src</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{authentication.user.profileImageURL}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">}\"</span> <span class=\"hljs-attr\">alt</span>=<span class=\"hljs-string\">\"</span></span></span><span class=\"hljs-template-variable\">{{authentication.user.displayName}</span><span class=\"xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">}\"</span>\n               <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"header-profile-image\"</span>/&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">ng-bind</span>=<span class=\"hljs-string\">\"authentication.user.displayName\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span> <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">b</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"caret\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">b</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"dropdown-menu\"</span> <span class=\"hljs-attr\">role</span>=<span class=\"hljs-string\">\"menu\"</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ui-sref-active</span>=<span class=\"hljs-string\">\"active\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"settings.profile\"</span>&gt;</span>Edit Profile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ui-sref-active</span>=<span class=\"hljs-string\">\"active\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"settings.picture\"</span>&gt;</span>Change Profile Picture<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">ui-sref-active</span>=<span class=\"hljs-string\">\"active\"</span> <span class=\"hljs-attr\">ng-show</span>=<span class=\"hljs-string\">\"authentication.user.provider === 'local'\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">ui-sref</span>=<span class=\"hljs-string\">\"settings.password\"</span>&gt;</span>Change Password<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n          <span class=\"hljs-comment\">&lt;!--li ui-sref-active=\"active\"&gt;\n            &lt;a ui-sref=\"settings.accounts\"&gt;Manage Social Accounts&lt;/a&gt;\n          &lt;/li--&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"divider\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"/api/auth/signout\"</span> <span class=\"hljs-attr\">target</span>=<span class=\"hljs-string\">\"_self\"</span>&gt;</span>Signout<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">nav</span>&gt;</span></span>\n</code></pre><h2 role=\"anchor\">\n            <a name=\"修改CSS\" role=\"anchor\">修改CSS</a>\n          </h2><p>为了让菜单看起来更自然些，这里修改的是 <code>core.css</code>，添加以下内容：</p>\n<pre><code><span class=\"hljs-selector-class\">.dropdown-submenu</span> {\n    <span class=\"hljs-attribute\">position</span>: relative;\n}\n\n<span class=\"hljs-selector-class\">.dropdown-menu</span> {\n    <span class=\"hljs-attribute\">-webkit-border-radius</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">-moz-border-radius</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">0</span>;\n}\n\n<span class=\"hljs-selector-class\">.dropdown-submenu</span> &gt; <span class=\"hljs-selector-class\">.dropdown-menu</span> {\n    <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">100%</span>;\n    <span class=\"hljs-attribute\">margin-top</span>: -<span class=\"hljs-number\">6px</span>;\n    <span class=\"hljs-attribute\">margin-left</span>: -<span class=\"hljs-number\">1px</span>;\n}\n\n<span class=\"hljs-selector-class\">.dropdown-submenu</span><span class=\"hljs-selector-pseudo\">:hover</span> &gt; <span class=\"hljs-selector-class\">.dropdown-menu</span> {\n    <span class=\"hljs-attribute\">display</span>: block;\n}\n\n<span class=\"hljs-selector-class\">.dropdown-submenu</span> &gt; <span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-pseudo\">:after</span> {\n    <span class=\"hljs-attribute\">display</span>: block;\n    <span class=\"hljs-attribute\">content</span>: <span class=\"hljs-string\">\" \"</span>;\n    <span class=\"hljs-attribute\">float</span>: right;\n    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">border-color</span>: transparent;\n    <span class=\"hljs-attribute\">border-style</span>: solid;\n    <span class=\"hljs-attribute\">border-width</span>: <span class=\"hljs-number\">5px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">5px</span> <span class=\"hljs-number\">5px</span>;\n    <span class=\"hljs-attribute\">border-left-color</span>: <span class=\"hljs-number\">#333</span>;\n    <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">5px</span> -<span class=\"hljs-number\">10px</span> <span class=\"hljs-number\">0</span>;\n}\n\n<span class=\"hljs-selector-class\">.dropdown-submenu</span><span class=\"hljs-selector-pseudo\">:hover</span> &gt; <span class=\"hljs-selector-tag\">a</span><span class=\"hljs-selector-pseudo\">:after</span> {\n    <span class=\"hljs-attribute\">border-left-color</span>: <span class=\"hljs-number\">#333</span>;\n}\n\n<span class=\"hljs-selector-class\">.dropdown-submenu</span><span class=\"hljs-selector-class\">.pull-left</span> {\n    <span class=\"hljs-attribute\">float</span>: none;\n}\n\n<span class=\"hljs-selector-class\">.dropdown-submenu</span><span class=\"hljs-selector-class\">.pull-left</span> &gt; <span class=\"hljs-selector-class\">.dropdown-menu</span> {\n    <span class=\"hljs-attribute\">left</span>: -<span class=\"hljs-number\">100%</span>;\n    <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">10px</span>;\n    <span class=\"hljs-attribute\">-webkit-border-radius</span>: <span class=\"hljs-number\">6px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">6px</span> <span class=\"hljs-number\">6px</span>;\n    <span class=\"hljs-attribute\">-moz-border-radius</span>: <span class=\"hljs-number\">6px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">6px</span> <span class=\"hljs-number\">6px</span>;\n    <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">6px</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">6px</span> <span class=\"hljs-number\">6px</span>;\n}\n</code></pre><p>&nbsp;</p>\n<h2 role=\"anchor\">\n            <a name=\"使用方法\" role=\"anchor\">使用方法</a>\n          </h2><p>3级菜单的定义方法与2级菜单一模一样，除了直接调用 <code>addSubMenuItemToSubMenu</code>  以外，还可以通过在2级菜单内定义 <code>items</code> 来实现添加子菜单，示例如下，高亮部分则为3级菜单：</p>\n<pre><code><span class=\"hljs-selector-tag\">Menus</span><span class=\"hljs-selector-class\">.addMenuItem</span>(<span class=\"hljs-string\">'topbar'</span>, {\n            <span class=\"hljs-attribute\">title</span>: <span class=\"hljs-string\">'...'</span>,\n            <span class=\"hljs-attribute\">state</span>: <span class=\"hljs-string\">'...'</span>,\n            <span class=\"hljs-attribute\">type</span>: <span class=\"hljs-string\">'dropdown'</span>,\n            <span class=\"hljs-attribute\">position</span>: <span class=\"hljs-number\">0</span>,\n            <span class=\"hljs-attribute\">roles</span>: [<span class=\"hljs-string\">'*'</span>],\n            <span class=\"hljs-attribute\">items</span>: [{\n                <span class=\"hljs-attribute\">title</span>: <span class=\"hljs-string\">'...'</span>,\n                <span class=\"hljs-attribute\">state</span>: <span class=\"hljs-string\">'...'</span>,\n                <span class=\"hljs-attribute\">roles</span>: [<span class=\"hljs-string\">'*'</span>]\n            }, {\n                <span class=\"hljs-attribute\">title</span>: <span class=\"hljs-string\">'...'</span>,\n                <span class=\"hljs-attribute\">state</span>: <span class=\"hljs-string\">'...'</span>,\n                <span class=\"hljs-attribute\">roles</span>: [<span class=\"hljs-string\">'*'</span>],\n                <span class=\"hljs-attribute\">items</span>: [{\n                    <span class=\"hljs-attribute\">title</span>: <span class=\"hljs-string\">'...'</span>,\n                    <span class=\"hljs-attribute\">state</span>: <span class=\"hljs-string\">'...'</span>,\n                    <span class=\"hljs-attribute\">roles</span>: [<span class=\"hljs-string\">'*'</span>]\n                }, {\n                    <span class=\"hljs-attribute\">title</span>: <span class=\"hljs-string\">'...'</span>,\n                    <span class=\"hljs-attribute\">state</span>: <span class=\"hljs-string\">'...'</span>,\n                    <span class=\"hljs-attribute\">roles</span>: [<span class=\"hljs-string\">'*'</span>]\n                }]\n            }]\n        });\n</code></pre><h2 role=\"anchor\">\n            <a name=\"实现无限级\" role=\"anchor\">实现无限级</a>\n          </h2><p>目前看来菜单层级的限制不是在于Service代码，而在于模板。如何在模板中让Angular做一个DFS搜索才是重点。Angular貌似没有提供类似的API，要做的话比较好的办法应该是自己写一个指令。以后有时间再来实现。</p>\n"}