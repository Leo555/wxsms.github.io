{"meta":{"id":"angular-tutorial-filters","title":"Angular 教程：过滤器","date":"2015-12-29T09:12:33.000Z","categories":["JavaScript"],"tags":["AngularJs"]},"html":"<p>在这一步中你将会学习如何创建自定义的过滤器。</p>\n<ul>\n<li>在上一步中，详细页面通过显示true或者false来表示一个手机是否具有某项功能。我们将使用一个自定义的过滤器来把这些字符串转换成图标：用✓表示true，用✘表示false</li>\n</ul>\n<p>最重要的改动如下所示。你可以在<a href=\"https://github.com/angular/angular-phonecat/compare/step-8...step-9\" title=\"See diff on Github\">GitHub</a>上查看它与之前的代码有何区别。</p>\n<hr>\n<h2>\n            <a name=\"自定义过滤器\" role=\"anchor\">\n              <span>自定义过滤器</span>\n            </a>\n          </h2><p>为了创建新的过滤器，我们创建了一个<code>phonecatFilters</code>模块，并且将自定义的过滤器注册在这个模块下。</p>\n<p><code>app/js/filters.js</code>：</p>\n<pre><code>angular.<span class=\"hljs-built_in\">module</span>(<span class=\"hljs-string\">'phonecatFilters'</span>, []).filter(<span class=\"hljs-string\">'checkmark'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span></span> {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(input)</span></span> {\n    <span class=\"hljs-keyword\">return</span> input ? <span class=\"hljs-string\">'\\u2713'</span> : <span class=\"hljs-string\">'\\u2718'</span>;\n  };\n});\n</code></pre><p>过滤器的名字叫checkmark，<code>input</code>将被转换为<code>true</code>或者<code>false</code>，然后我们根据结果返回两个unicode编码字符中的其中之一。 现在过滤器已经准备好了，我们需要给<code>phonecatApp</code>主模块添加一项<code>phonecatFilters</code>模块的依赖。</p>\n<p><code>app/js/app.js</code>：</p>\n<pre><code>...\nangular.<span class=\"hljs-keyword\">module</span>(<span class=\"hljs-string\">'phonecatApp'</span>, [<span class=\"hljs-string\">'ngRoute'</span>,<span class=\"hljs-string\">'phonecatControllers'</span>,<span class=\"hljs-string\">'phonecatFilters'</span>]);\n...\n</code></pre><hr>\n<h2>\n            <a name=\"模板\" role=\"anchor\">\n              <span>模板</span>\n            </a>\n          </h2><p>既然过滤器代码存在于<code>app/js/filters.js</code></p>\n<p>文件内，我们就需要把它包含到布局模版中。</p>\n<p><code>app/index.html</code>：</p>\n<pre><code>...\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"js/controllers.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"js/filters.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n...\n</code></pre><p>在Angualr中根据以下语法来使用过滤器：</p>\n<pre><code>{{ expression | filter }}\n</code></pre><p>现在我们来给手机详细模板添加过滤器：</p>\n<p><code>app/partials/phone-detail.html</code>：</p>\n<pre><code><span class=\"xml\">...\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dl</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dt</span>&gt;</span>Infrared<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dt</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dd</span>&gt;</span></span><span class=\"hljs-template-variable\">{{phone.connectivity.infrared | checkmark}}</span><span class=\"xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dd</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dt</span>&gt;</span>GPS<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dt</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dd</span>&gt;</span></span><span class=\"hljs-template-variable\">{{phone.connectivity.gps | checkmark}}</span><span class=\"xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dd</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dl</span>&gt;</span>\n...</span>\n</code></pre><hr>\n<h2>\n            <a name=\"测试\" role=\"anchor\">\n              <span>测试</span>\n            </a>\n          </h2><p>就像任何其它的组件一样，过滤器也应该要测一测。所幸的是编写这些测试是非常简单的事情。</p>\n<p><code>test/unit/filtersSpec.js</code>：</p>\n<pre><code>describe('filter', function() {\n\n  beforeEach(<span class=\"hljs-name\">module</span>('phonecatFilters'))<span class=\"hljs-comment\">;</span>\n\n  describe('checkmark', function() {\n\n    it('should convert boolean values to unicode checkmark or cross',\n        inject(<span class=\"hljs-name\">function</span>(<span class=\"hljs-name\">checkmarkFilter</span>) {\n      expect(<span class=\"hljs-name\">checkmarkFilter</span>(<span class=\"hljs-name\">true</span>)).toBe('\\u2713')<span class=\"hljs-comment\">;</span>\n      expect(<span class=\"hljs-name\">checkmarkFilter</span>(<span class=\"hljs-name\">false</span>)).toBe('\\u2718')<span class=\"hljs-comment\">;</span>\n    }))<span class=\"hljs-comment\">;</span>\n  })<span class=\"hljs-comment\">;</span>\n})<span class=\"hljs-comment\">;</span>\n</code></pre><p>在每一个过滤器测试执行以前我们都必须调用<code>beforeEach(module(&#39;phonecatFilters&#39;))</code>，这个调用将<code>phonecatFilters</code>模块加载到了这些测试的注入器中。 需要注意的是我们调用了工具方法<code>inject(function(checkmarkFilter) { ... })</code>来获取需要被测试的过滤器。参考<a href=\"https://docs.angularjs.org/api/ngMock/function/angular.mock.inject\">angular.mock.inject()</a> 与此同时我们也注意到Filter后缀被追加到了我们定义的过滤器名字之后。参考<a href=\"https://docs.angularjs.org/guide/filter#using-filters-in-controllers-services-and-directives\">Filter Guide</a>来获取与此有关的信息。 你现在应该能在Karma控制台中看到如下输出：</p>\n<pre><code>Chrome <span class=\"hljs-number\">22.0</span>: Executed <span class=\"hljs-number\">4</span> <span class=\"hljs-keyword\">of</span> <span class=\"hljs-number\">4</span> SUCCESS (<span class=\"hljs-number\">0.034</span> <span class=\"hljs-built_in\">secs</span> / <span class=\"hljs-number\">0.012</span> <span class=\"hljs-built_in\">secs</span>)\n</code></pre><h2>\n            <a name=\"课外扩展\" role=\"anchor\">\n              <span>课外扩展</span>\n            </a>\n          </h2><p>我们来试试给<code>index.html</code>中的绑定添加一些<a href=\"https://docs.angularjs.org/api/ng/filter\">Angular的内置过滤器</a>吧：</p>\n<ul>\n<li><code>{{ &quot;lower cap string&quot; | uppercase }}</code></li>\n<li><code>{{ {foo: &quot;bar&quot;, baz: 23} | json }}</code></li>\n<li><code>{{ 1304375948024 | date }}</code></li>\n<li><code>{{ 1304375948024 | date:&quot;MM/dd/yyyy @ h:mma&quot; }}</code></li>\n</ul>\n<p>与此同时我们也可以创建一个带有输入框的模型，然后给它添加一个带过滤器的绑定：</p>\n<pre><code><span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">ng-model</span>=<span class=\"hljs-string\">\"userInput\"</span>&gt;</span> Uppercased: </span><span class=\"hljs-template-variable\">{{ userInput | uppercase }}</span><span class=\"xml\"></span>\n</code></pre><h2>\n            <a name=\"总结\" role=\"anchor\">\n              <span>总结</span>\n            </a>\n          </h2><p>现在我们学会了如何编写和测试自定义的过滤器，通过<a href=\"/p/angular-tutorial-event-handlers/\">step 10</a>来学习如何使用Angular扩展手机详细页面。</p>\n"}